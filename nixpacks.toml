buildImage = 'ghcr.io/railwayapp/nixpacks:ubuntu-1705968199'

# Build plan from the provider
[phases.setup]
cmds = ['./touch_env.sh']
onlyIncludeFiles = ['./touch_env.sh']
nixPkgs = ['nodejs_16', 'binutils', 'gcc', 'curl', 'bash', 'rust-bin.stable.latest.default']

[phases.install]
cmds = ['cd client/ && npm i']

[phases.build]
dependsOn = ['install']
cmds = ['cd client/ && NODE_OPTIONS=--openssl-legacy-provider npm run build', 'mkdir -p bin', 'cargo build --release', 'cp target/release/bpon bin']

